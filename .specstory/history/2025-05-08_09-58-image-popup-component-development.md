<!-- Generated by SpecStory -->

# Image Popup Component Development (2025-05-08 14:58:04)

_**User**_

@page.tsx now wjen click on image a pop up should open with all details take inspiration from this create sperate compnent for popup

match our current theme 

also keep this full page when i right click and open image in new tab then this full page should open 



---

_**Assistant**_

I'll create a popup component for image details while preserving the full page view when opening in a new tab. First, let me examine the current structure.

---

<details>
            <summary>Listed directory components • **7** results</summary>
        
| Name |
|-------|
| 📁 `gallery` |
| 📁 `site` |
| 📁 `contributor` |
| 📁 `ui` |
| 📁 `sadmin` |
| 📁 `admin` |
| 📁 `upload` |

</details>

---

<details>
            <summary>Listed directory components/ui • **18** results</summary>
        
| Name |
|-------|
| 📄 `image-with-pattern.tsx` |
| 📄 `input.tsx` |
| 📄 `Checkbox.tsx` |
| 📄 `dialog.tsx` |
| 📄 `alert-dialog.tsx` |
| 📄 `form.tsx` |
| 📄 `tabs.tsx` |
| 📄 `separator.tsx` |
| 📄 `switch.tsx` |
| 📄 `accordion.tsx` |
| 📄 `radio-group.tsx` |
| 📄 `label.tsx` |
| 📄 `select.tsx` |
| 📄 `badge.tsx` |
| 📄 `textarea.tsx` |
| 📄 `button.tsx` |
| 📄 `dropdown-menu.tsx` |
| 📄 `avatar.tsx` |

</details>

---

<details>
            <summary>Listed directory components/gallery • **4** results</summary>
        
| Name |
|-------|
| 📄 `SearchBar.tsx` |
| 📄 `FilterSidebar.tsx` |
| 📄 `GallerySkeleton.tsx` |
| 📄 `ImageDetailActions.tsx` |

</details>

---

Read file: components/ui/dialog.tsx

---

Read file: components/gallery/ImageDetailActions.tsx

---

Now I'll create a new ImageDetailsDialog component that will display the image in a popup while preserving the existing page functionality:

---

```diff
- 
+ "use client";
+ 
+ import { useState } from "react";
+ import Link from "next/link";
+ import { 
+   ArrowLeft,
+   Calendar, 
+   Tag,
+   Download,
+   Eye,
+   UserCircle2,
+   ShieldCheck,
+   FileType,
+   Palette,
+   X
+ } from "lucide-react";
+ import Image from "next/image";
+ import { Dialog, DialogContent } from "@/components/ui/dialog";
+ import { Badge } from "@/components/ui/badge";
+ import { ImageWithPattern } from "@/components/ui/image-with-pattern";
+ import { ImageDetailActions } from "@/components/gallery/ImageDetailActions";
+ 
+ interface ImageDetailsDialogProps {
+   isOpen: boolean;
+   onClose: () => void;
+   image: any;
+   relatedImages: any[];
+   similarImages: any[];
+ }
+ 
+ export function ImageDetailsDialog({
+   isOpen,
+   onClose,
+   image,
+   relatedImages,
+   similarImages
+ }: ImageDetailsDialogProps) {
+   // Format image type for display
+   const imageType = image.imageType || 'JPG';
+   const isAiGenerated = image.aiGeneratedStatus === 'AI_GENERATED';
+ 
+   return (
+     <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>
+       <DialogContent className="max-w-6xl p-0 h-[90vh] overflow-y-auto">
+         <button 
+           onClick={onClose} 
+           className="absolute right-4 top-4 z-10 bg-white rounded-full p-1.5 shadow-md hover:bg-gray-100 transition-colors"
+         >
+           <X className="h-5 w-5" />
+         </button>
+         
+         <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 p-6">
+           {/* Image Column */}
+           <div className="lg:col-span-2 space-y-6">
+             {/* Main Image Display */}
+             <div className="bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100">
+               <div className="relative">
+                 {/* Download Count Badge */}
+                 <div className="absolute top-4 right-4 z-10 bg-black bg-opacity-70 text-white text-xs px-3 py-1.5 rounded-full flex items-center">
+                   <Download className="w-3.5 h-3.5 mr-1.5" />
+                   <span>{image.downloads || 0} downloads</span>
+                 </div>
+                 
+                 {/* AI Badge if applicable */}
+                 {isAiGenerated && (
+                   <div className="absolute top-4 left-4 z-10 bg-purple-100 border border-purple-200 text-purple-800 text-xs px-3 py-1.5 rounded-full">
+                     AI Generated
+                   </div>
+                 )}
+                 
+                 {/* Main Image */}
+                 <div className="aspect-[4/3] bg-gray-50 flex items-center justify-center relative">
+                   <ImageWithPattern 
+                     src={image.imageUrl}
+                     alt={image.title}
+                     fill
+                     priority
+                     sizes="(max-width: 768px) 100vw, (max-width: 1200px) 60vw, 50vw"
+                     className="object-contain h-full w-full"
+                     imageType={imageType}
+                     showResolution={true}
+                   />
+                 </div>
+               </div>
+             </div>
+             
+             {/* Image Description */}
+             <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
+               <h2 className="text-lg font-semibold text-gray-800 mb-4">Description</h2>
+               <p className="text-gray-700">{image.description || 'No description provided'}</p>
+             </div>
+             
+             {/* Similar Content */}
+             {similarImages.length > 0 && (
+               <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
+                 <h2 className="text-lg font-semibold text-gray-800 mb-4">Similar content</h2>
+                 <div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
+                   {similarImages.slice(0, 3).map((item) => (
+                     <Link 
+                       key={item.id} 
+                       href={`/gallery/${item.id}`}
+                       className="group block aspect-square relative rounded-lg overflow-hidden"
+                       onClick={(e) => {
+                         e.preventDefault();
+                         window.open(`/gallery/${item.id}`, '_blank');
+                       }}
+                     >
+                       <Image 
+                         src={item.imageUrl}
+                         alt={item.title}
+                         fill
+                         sizes="(max-width: 768px) 33vw, 20vw"
+                         className="object-cover transform group-hover:scale-105 transition-transform duration-500"
+                       />
+                       <div className="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end">
+                         <div className="p-3">
+                           <p className="text-white text-xs font-medium line-clamp-2">
+                             {item.title}
+                           </p>
+                         </div>
+                       </div>
+                     </Link>
+                   ))}
+                 </div>
+               </div>
+             )}
+           </div>
+           
+           {/* Sidebar */}
+           <div className="space-y-6">
+             {/* Image Information */}
+             <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
+               <div className="p-6">
+                 <h1 className="text-2xl font-bold text-gray-900 mb-4">{image.title}</h1>
+                 
+                 {/* Author info with avatar */}
+                 <Link 
+                   href={`/creator/${image.userId}`} 
+                   className="flex items-center space-x-3 mb-6 group"
+                   onClick={(e) => {
+                     e.preventDefault();
+                     window.open(`/creator/${image.userId}`, '_blank');
+                   }}
+                 >
+                   <div className="h-10 w-10 rounded-full bg-gray-100 overflow-hidden relative flex-shrink-0">
+                     {image.user.image ? (
+                       <Image 
+                         src={image.user.image}
+                         alt={image.user.name || "Creator"}
+                         fill
+                         className="object-cover"
+                       />
+                     ) : (
+                       <div className="h-full w-full flex items-center justify-center text-gray-400">
+                         <UserCircle2 className="h-full w-full" />
+                       </div>
+                     )}
+                   </div>
+                   <div>
+                     <p className="font-medium text-gray-900 group-hover:text-blue-600 transition-colors">
+                       {image.user.name || image.user.email.split('@')[0]}
+                     </p>
+                     <p className="text-sm text-gray-500">View profile</p>
+                   </div>
+                 </Link>
+                 
+                 {/* Action Buttons */}
+                 <ImageDetailActions 
+                   imageId={image.id} 
+                   imageUrl={image.imageUrl} 
+                   title={image.title}
+                   currentDownloads={image.downloads || 0}
+                   currentViews={image.views || 0}
+                 />
+               </div>
+               
+               {/* Image details section */}
+               <div className="border-t border-gray-100 px-6 py-4 bg-gray-50 space-y-4">
+                 <div className="flex">
+                   <div className="w-1/3 text-sm text-gray-500">License</div>
+                   <div className="w-2/3 text-sm text-gray-900 flex items-center">
+                     <ShieldCheck className="w-4 h-4 mr-2 text-emerald-500" />
+                     {image.license || 'Standard License'}
+                   </div>
+                 </div>
+                 
+                 <div className="flex">
+                   <div className="w-1/3 text-sm text-gray-500">File type</div>
+                   <div className="w-2/3 text-sm text-gray-900 flex items-center">
+                     <FileType className="w-4 h-4 mr-2 text-blue-500" />
+                     {imageType}
+                   </div>
+                 </div>
+                 
+                 <div className="flex">
+                   <div className="w-1/3 text-sm text-gray-500">Resolution</div>
+                   <div className="w-2/3 text-sm text-gray-900 flex items-center">
+                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4 mr-2 text-orange-500">
+                       <rect x="3" y="3" width="18" height="18" rx="2" />
+                       <path d="M3 9h18" />
+                       <path d="M9 21V9" />
+                     </svg>
+                     High Quality Image
+                   </div>
+                 </div>
+                 
+                 <div className="flex">
+                   <div className="w-1/3 text-sm text-gray-500">Category</div>
+                   <div className="w-2/3 text-sm text-gray-900">
+                     <Link 
+                       href={`/gallery?category=${image.category}`}
+                       className="flex items-center hover:text-blue-600 transition-colors"
+                       onClick={(e) => {
+                         e.preventDefault();
+                         window.open(`/gallery?category=${image.category}`, '_blank');
+                       }}
+                     >
+                       <Palette className="w-4 h-4 mr-2 text-purple-500" />
+                       {image.category}
+                     </Link>
+                   </div>
+                 </div>
+                 
+                 <div className="flex">
+                   <div className="w-1/3 text-sm text-gray-500">Date added</div>
+                   <div className="w-2/3 text-sm text-gray-900 flex items-center">
+                     <Calendar className="w-4 h-4 mr-2 text-amber-500" />
+                     {new Date(image.createdAt).toLocaleDateString('en-US', {
+                       year: 'numeric',
+                       month: 'short',
+                       day: 'numeric'
+                     })}
+                   </div>
+                 </div>
+               </div>
+             </div>
+             
+             {/* Tags */}
+             {image.tags && image.tags.length > 0 && (
+               <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
+                 <h2 className="text-base font-semibold text-gray-800 mb-3">Tags</h2>
+                 <div className="flex flex-wrap gap-2">
+                   {image.tags.map((tag, index) => (
+                     <Link 
+                       key={index} 
+                       href={`/gallery?q=${tag}`}
+                       className="inline-flex items-center px-3 py-1 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-800 text-xs transition-colors"
+                       onClick={(e) => {
+                         e.preventDefault();
+                         window.open(`/gallery?q=${tag}`, '_blank');
+                       }}
+                     >
+                       <Tag className="w-3 h-3 mr-1.5" />
+                       {tag}
+                     </Link>
+                   ))}
+                 </div>
+               </div>
+             )}
+             
+             {/* Legal Info */}
+             <div className="rounded-xl p-4 bg-gray-50 border border-gray-200 text-xs text-gray-500">
+               <p className="mb-3">
+                 This resource can be used for personal and commercial projects with attribution.
+               </p>
+               <p>
+                 &copy; {new Date().getFullYear()} {image.user.name || 'Creator'} / KlickStock 
+               </p>
+             </div>
+           </div>
+         </div>
+       </DialogContent>
+     </Dialog>
+   );
+ } 
```

---

Now, let's create a component for the gallery image card that will open the dialog when clicked:

---

```diff
- 
+ "use client";
+ 
+ import { useState } from "react";
+ import Image from "next/image";
+ import Link from "next/link";
+ import { ImageDetailsDialog } from "./ImageDetailsDialog";
+ 
+ interface GalleryImageCardProps {
+   image: any;
+   relatedImages: any[];
+   similarImages: any[];
+ }
+ 
+ export function GalleryImageCard({ image, relatedImages, similarImages }: GalleryImageCardProps) {
+   const [isDialogOpen, setIsDialogOpen] = useState(false);
+ 
+   // Format tags for display if they exist
+   const tags = image.tags || [];
+   const isAiGenerated = image.aiGeneratedStatus === 'AI_GENERATED';
+ 
+   return (
+     <>
+       <div 
+         onClick={() => setIsDialogOpen(true)}
+         className="group bg-white rounded-lg overflow-hidden shadow-sm border border-gray-100 hover:shadow-md transition-all cursor-pointer"
+       >
+         <div className="aspect-square relative overflow-hidden">
+           {/* AI Badge if applicable */}
+           {isAiGenerated && (
+             <div className="absolute top-2 left-2 z-10 bg-purple-100 border border-purple-200 text-purple-800 text-xs px-2 py-0.5 rounded-full">
+               AI
+             </div>
+           )}
+           
+           <Image 
+             src={image.imageUrl}
+             alt={image.title}
+             fill
+             sizes="(max-width: 640px) 50vw, (max-width: 1024px) 33vw, 25vw"
+             className="object-cover transform group-hover:scale-105 transition-transform duration-500"
+           />
+         </div>
+         <div className="p-3">
+           <h3 className="text-sm font-medium text-gray-900 group-hover:text-blue-600 transition-colors truncate">
+             {image.title}
+           </h3>
+           
+           {/* Display category as badge */}
+           <div className="mt-2 flex items-center justify-between">
+             <span className="text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded-full">
+               {image.category}
+             </span>
+             
+             {/* Display downloads if available */}
+             {typeof image.downloads === 'number' && (
+               <span className="text-xs text-gray-500">
+                 {image.downloads} downloads
+               </span>
+             )}
+           </div>
+         </div>
+       </div>
+       
+       {/* Right-click context menu handler - opens in new tab */}
+       <Link 
+         href={`/gallery/${image.id}`}
+         className="hidden"
+         id={`full-page-link-${image.id}`}
+         target="_blank"
+         rel="noopener noreferrer"
+       />
+       
+       {/* Image Details Dialog */}
+       <ImageDetailsDialog
+         isOpen={isDialogOpen}
+         onClose={() => setIsDialogOpen(false)}
+         image={image}
+         relatedImages={relatedImages}
+         similarImages={similarImages}
+       />
+     </>
+   );
+ } 
```

---

Now, let's update the page component to use our new GalleryImageCard component:

---

```diff
  
  // Server action to increment view count
- async function incrementViewCount(id: string) {
+ export async function incrementViewCount(id: string) {
    'use server';
    
```

```diff
  }
  
- export default async function ImageDetailPage({ params }: { params: Promise<{ id: string }> }) {
-   const { id } = await params;
-   
-   // Increment view count
-   await incrementViewCount(id);
-   
-   // Fetch the image details
-   const image = await db.contributorItem.findUnique({
+ // Fetch image data server function (exported for reuse)
+ export async function getImageDetails(id: string) {
+   return await db.contributorItem.findUnique({
      where: { 
        id,
```

```diff
      }
    });
-   
-   // If image not found or not approved, return 404
-   if (!image) {
-     notFound();
-   }
-   
-   // Fetch related images by the same user
-   const relatedImages = await db.contributorItem.findMany({
+ }
+ 
+ // Fetch related images by same user
+ export async function getRelatedImages(userId: string, currentImageId: string) {
+   return await db.contributorItem.findMany({
      where: {
-       userId: image.userId,
+       userId,
        status: "APPROVED",
-       id: { not: image.id } // Exclude current image
+       id: { not: currentImageId } // Exclude current image
      },
      orderBy: { createdAt: 'desc' },
      take: 6
    });
-   
-   // Also fetch similar images by category or tags
-   const similarImages = await db.contributorItem.findMany({
+ }
+ 
+ // Fetch similar images by category or tags
+ export async function getSimilarImages(category: string, tags: string[], currentImageId: string) {
+   return await db.contributorItem.findMany({
      where: {
-       id: { not: image.id }, // Exclude current image
+       id: { not: currentImageId }, // Exclude current image
        status: "APPROVED",
        OR: [
-         { category: image.category },
-         { tags: { hasSome: image.tags } }
+         { category },
+         { tags: { hasSome: tags } }
        ]
      },
      orderBy: { downloads: 'desc' },
      take: 6
    });
+ }
+ 
+ export default async function ImageDetailPage({ params }: { params: Promise<{ id: string }> }) {
+   const { id } = await params;
+   
+   // Increment view count
+   await incrementViewCount(id);
+   
+   // Fetch the image details
+   const image = await getImageDetails(id);
+   
+   // If image not found or not approved, return 404
+   if (!image) {
+     notFound();
+   }
+   
+   // Fetch related images by the same user
+   const relatedImages = await getRelatedImages(image.userId, image.id);
+   
+   // Also fetch similar images by category or tags
+   const similarImages = await getSimilarImages(image.category, image.tags, image.id);
  
    // Format image type for display
```

---

Finally, let's create a page route that provides the image data for the GalleryImageCard component:

---

```diff
- 
+ import { NextRequest, NextResponse } from "next/server";
+ import { db } from "@/lib/prisma";
+ import { getImageDetails, getRelatedImages, getSimilarImages, incrementViewCount } from "@/app/(site)/gallery/[id]/page";
+ 
+ export async function GET(
+   request: NextRequest,
+   { params }: { params: { id: string } }
+ ) {
+   try {
+     const { id } = params;
+     
+     // Increment view count
+     await incrementViewCount(id);
+     
+     // Fetch the image details
+     const image = await getImageDetails(id);
+     
+     // If image not found or not approved, return 404
+     if (!image) {
+       return NextResponse.json({ error: "Image not found" }, { status: 404 });
+     }
+     
+     // Fetch related images by the same user
+     const relatedImages = await getRelatedImages(image.userId, image.id);
+     
+     // Also fetch similar images by category or tags
+     const similarImages = await getSimilarImages(image.category, image.tags, image.id);
+     
+     return NextResponse.json({
+       image,
+       relatedImages,
+       similarImages
+     });
+     
+   } catch (error) {
+     console.error("Error fetching image data:", error);
+     return NextResponse.json({ error: "Failed to fetch image data" }, { status: 500 });
+   }
+ } 
```

---

Now, let's create a Gallery component that uses our new GalleryImageCard component:

---

```diff
- 
+ "use client";
+ 
+ import { useState, useEffect } from "react";
+ import { GalleryImageCard } from "./GalleryImageCard";
+ import { GallerySkeleton } from "./GallerySkeleton";
+ 
+ interface GalleryGridProps {
+   images: any[];
+ }
+ 
+ export function GalleryGrid({ images }: GalleryGridProps) {
+   const [imagesWithData, setImagesWithData] = useState<Record<string, any>>({});
+   const [loadingIds, setLoadingIds] = useState<Set<string>>(new Set());
+   
+   // Prefetch data for first few images to optimize performance
+   useEffect(() => {
+     if (images && images.length > 0) {
+       // Only prefetch first 8 images to avoid too many requests
+       const firstImages = images.slice(0, 8);
+       
+       const newLoadingIds = new Set(loadingIds);
+       
+       firstImages.forEach(image => {
+         if (!imagesWithData[image.id] && !newLoadingIds.has(image.id)) {
+           newLoadingIds.add(image.id);
+         }
+       });
+       
+       setLoadingIds(newLoadingIds);
+       
+       // Fetch data for each image
+       firstImages.forEach(async (image) => {
+         if (!imagesWithData[image.id]) {
+           try {
+             const response = await fetch(`/api/images/${image.id}`);
+             if (response.ok) {
+               const data = await response.json();
+               
+               setImagesWithData(prev => ({
+                 ...prev,
+                 [image.id]: {
+                   image: data.image,
+                   relatedImages: data.relatedImages,
+                   similarImages: data.similarImages
+                 }
+               }));
+             }
+           } catch (error) {
+             console.error(`Error fetching data for image ${image.id}:`, error);
+           } finally {
+             setLoadingIds(prev => {
+               const newIds = new Set(prev);
+               newIds.delete(image.id);
+               return newIds;
+             });
+           }
+         }
+       });
+     }
+   }, [images]);
+   
+   // Fetch image data when user clicks (if not prefetched)
+   const handleFetchImageData = async (imageId: string) => {
+     if (imagesWithData[imageId]) {
+       return imagesWithData[imageId];
+     }
+     
+     setLoadingIds(prev => new Set(prev).add(imageId));
+     
+     try {
+       const response = await fetch(`/api/images/${imageId}`);
+       if (response.ok) {
+         const data = await response.json();
+         
+         const imageData = {
+           image: data.image,
+           relatedImages: data.relatedImages,
+           similarImages: data.similarImages
+         };
+         
+         setImagesWithData(prev => ({
+           ...prev,
+           [imageId]: imageData
+         }));
+         
+         return imageData;
+       }
+     } catch (error) {
+       console.error(`Error fetching data for image ${imageId}:`, error);
+     } finally {
+       setLoadingIds(prev => {
+         const newIds = new Set(prev);
+         newIds.delete(imageId);
+         return newIds;
+       });
+     }
+     
+     return null;
+   };
+   
+   // Add window event listener for context menu to handle right-clicks
+   useEffect(() => {
+     const handleContextMenu = (e: MouseEvent) => {
+       // Find the closest parent with id that starts with 'full-page-link-'
+       let target = e.target as HTMLElement;
+       let linkElement = null;
+       
+       // Traverse up the DOM tree to find a card element
+       while (target && !linkElement) {
+         if (target.dataset && target.dataset.imageId) {
+           const imageId = target.dataset.imageId;
+           linkElement = document.getElementById(`full-page-link-${imageId}`);
+           break;
+         }
+         target = target.parentElement as HTMLElement;
+       }
+       
+       // If a link element is found, don't prevent default behavior
+       // This allows the browser to show its context menu
+       // When the user selects "Open in new tab" it will use the target URL
+     };
+     
+     window.addEventListener('contextmenu', handleContextMenu);
+     
+     return () => {
+       window.removeEventListener('contextmenu', handleContextMenu);
+     };
+   }, []);
+ 
+   return (
+     <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6">
+       {images.map((image) => {
+         // For each image, show the card with prefetched data if available
+         const imageData = imagesWithData[image.id];
+         
+         // If data is loaded, render the card with full data
+         if (imageData) {
+           return (
+             <div key={image.id} data-image-id={image.id}>
+               <GalleryImageCard
+                 image={imageData.image}
+                 relatedImages={imageData.relatedImages}
+                 similarImages={imageData.similarImages}
+               />
+             </div>
+           );
+         }
+         
+         // Otherwise, render the card with basic data and load more when clicked
+         return (
+           <div 
+             key={image.id}
+             data-image-id={image.id}
+             onClick={async () => {
+               if (!loadingIds.has(image.id)) {
+                 await handleFetchImageData(image.id);
+               }
+             }}
+             className={`group bg-white rounded-lg overflow-hidden shadow-sm border border-gray-100 hover:shadow-md transition-all cursor-pointer ${loadingIds.has(image.id) ? 'opacity-70' : ''}`}
+           >
+             <div className="aspect-square relative overflow-hidden">
+               {loadingIds.has(image.id) ? (
+                 <div className="absolute inset-0 flex items-center justify-center bg-gray-50">
+                   <div className="w-10 h-10 border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin"></div>
+                 </div>
+               ) : null}
+               
+               <img 
+                 src={image.imageUrl}
+                 alt={image.title}
+                 className="object-cover w-full h-full transform group-hover:scale-105 transition-transform duration-500"
+               />
+             </div>
+             <div className="p-3">
+               <h3 className="text-sm font-medium text-gray-900 group-hover:text-blue-600 transition-colors truncate">
+                 {image.title}
+               </h3>
+               
+               {/* Display category as badge */}
+               <div className="mt-2 flex items-center justify-between">
+                 <span className="text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded-full">
+                   {image.category}
+                 </span>
+                 
+                 {/* Display downloads if available */}
+                 {typeof image.downloads === 'number' && (
+                   <span className="text-xs text-gray-500">
+                     {image.downloads} downloads
+                   </span>
+                 )}
+               </div>
+             </div>
+             
+             {/* Hidden link for right-click */}
+             <a 
+               href={`/gallery/${image.id}`}
+               className="hidden"
+               id={`full-page-link-${image.id}`}
+               target="_blank"
+               rel="noopener noreferrer"
+             />
+           </div>
+         );
+       })}
+     </div>
+   );
+ } 
```

---

Let's check to see if we have a main gallery page to update:

---

<details>
            <summary>Searched codebase "gallery page.tsx" • **10** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

Read file: app/(site)/gallery/page.tsx

---

Now let's update the gallery page to use our new GalleryGrid component:

---

```diff
  import { SearchBar } from "@/components/gallery/SearchBar";
  import { Prisma } from "@prisma/client";
+ import { GalleryGrid } from "@/components/gallery/GalleryGrid";
  
  // Filter options
```

```diff
                      isFilterActive('sort', option.value)
                        ? 'bg-indigo-600 text-white'
-                       : 'bg-gray-800 text-gray-300 hover:bg-gray-700'
+                       : 'bg-gray-800 text-gray-300 hover:text-white'
                    }`}
                  >
```

```diff
              </div>
  
-             {/* Applied filters pills moved to top right */}
+             {/* Applied filters with clear button */}
              {hasFilters && (
-               <div className="flex flex-wrap gap-2 items-center mt-3 lg:mt-0">
-                 {categoryFilter && (
-                   <div className="text-gray-300 text-sm px-3 py-2.5 flex items-center gap-1 bg-gray-800/50 rounded-full">
-                     <span>{CATEGORIES.find(c => c.value === categoryFilter)?.label || categoryFilter}</span>
-                     <Link href={getFilterUrl('category', '')} className="text-gray-400 hover:text-white">
-                       <X className="w-4 h-4" />
-                     </Link>
-                   </div>
-                 )}
-                 
-                 {imageTypeFilter && (
-                   <div className="text-gray-300 text-sm px-3 py-2.5 flex items-center gap-1 bg-gray-800/50 rounded-full">
-                     <span>{IMAGE_TYPES.find(t => t.value === imageTypeFilter)?.label || imageTypeFilter}</span>
-                     <Link href={getFilterUrl('imageType', '')} className="text-gray-400 hover:text-white">
-                       <X className="w-4 h-4" />
-                     </Link>
-                   </div>
-                 )}
-                 
-                 {aiGeneratedFilter && (
-                   <div className="text-gray-300 text-sm px-3 py-2.5 flex items-center gap-1 bg-gray-800/50 rounded-full">
-                     <span>{AI_STATUS.find(s => s.value === aiGeneratedFilter)?.label || aiGeneratedFilter}</span>
-                     <Link href={getFilterUrl('aiGenerated', '')} className="text-gray-400 hover:text-white">
-                       <X className="w-4 h-4" />
-                     </Link>
-                   </div>
-                 )}
-                 
+               <div className="flex items-center mt-3 lg:mt-0">
                  <Link 
                    href={getClearFilterUrl()}
-                   className="text-sm text-gray-400 hover:text-indigo-300 px-3 py-2.5 transition-colors rounded-full bg-gray-800/50"
+                   className="px-4 py-2 rounded-full bg-red-600/20 text-red-200 hover:bg-red-600/30 text-sm flex items-center"
                  >
-                   Clear filters
+                   <X className="h-3.5 w-3.5 mr-1.5" />
+                   Clear Filters
                  </Link>
                </div>
              )}
            </div>
- 
+           
+           {/* Results notification */}
+           <div className="mb-6">
+             <h1 className="text-xl font-semibold text-white mb-1">
+               {totalItems} results
+               {searchQuery && <span> for "{searchQuery}"</span>}
+             </h1>
+             <p className="text-gray-500 text-sm">
+               {categoryFilter && (
+                 <span>
+                   in <span className="text-indigo-400">{categoryFilter}</span>
+                   {' • '}
+                 </span>
+               )}
+               Page {currentPage} of {totalPages}
+             </p>
+           </div>
+ 
+           {/* Gallery grid with items */}
            {approvedItems.length > 0 ? (
-             <>
-               <div className="columns-1 sm:columns-2 lg:columns-3 2xl:columns-4 gap-6 space-y-6">
-                 {approvedItems.map((item: ItemWithUser) => (
-                   <Link 
-                     href={`/gallery/${item.id}`} 
-                     key={item.id}
-                     className="group block break-inside-avoid mb-6"
-                   >
-                     <div className="bg-gray-900/60 rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all border border-gray-800/50 hover:border-indigo-500/50 relative">
-                       <div className="relative w-full">
-                         <ImageWithPattern 
-                           src={item.imageUrl}
-                           alt={item.title}
-                           width={800}
-                           height={800}
-                           className="w-full transition-transform duration-500 group-hover:scale-110"
-                           imageType={getImageType(item)}
-                         />
-                       </div>
-                       {isAiGenerated(item) && (
-                         <div className="absolute top-3 left-3 bg-purple-600/80 text-white text-xs py-0.5 px-2 rounded font-medium">
-                           AI Generated
-                         </div>
-                       )}
-                       <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-gray-950 to-transparent p-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
-                         <h3 className="text-white font-medium truncate">
-                           {item.title}
-                         </h3>
-                         <div className="flex justify-between items-center mt-1">
-                           <p className="text-sm text-gray-300">
-                             By {item.user.name || item.user.email.split('@')[0]}
-                           </p>
-                           <div className="flex items-center gap-1 text-sm text-gray-400">
-                             <span>{item.views || 0}</span>
-                             <Eye className="w-4 h-4" />
-                           </div>
-                         </div>
-                       </div>
-                     </div>
-                   </Link>
-                 ))}
+             <div className="mb-10">
+               <GalleryGrid images={approvedItems} />
+             </div>
+           ) : (
+             <div className="bg-gray-900/50 rounded-lg p-8 text-center">
+               <div className="mx-auto w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center mb-4">
+                 <ImageIcon className="w-8 h-8 text-gray-500" />
                </div>
+               <h3 className="text-lg font-medium text-white mb-2">No images found</h3>
+               <p className="text-gray-400 mb-6">
+                 {searchQuery
+                   ? `We couldn't find any images matching "${searchQuery}"`
+                   : "No images match your filter criteria"}
+               </p>
+               <Link
+                 href="/gallery" 
+                 className="inline-block px-4 py-2 rounded-md bg-indigo-600 text-white hover:bg-indigo-700"
+               >
+                 View all images
+               </Link>
+             </div>
+           )}
  
-               {/* Pagination */}
-               {totalPages > 1 && (
-                 <div className="mt-12 flex justify-center">
-                   <nav className="flex items-center gap-1">
-                     {/* Previous page button */}
-                     <Link 
-                       href={currentPage > 1 ? getPaginationUrl(currentPage - 1) : '#'}
-                       className={`flex items-center justify-center w-10 h-10 rounded-full ${
-                         currentPage > 1 
-                           ? 'text-white bg-gray-800 hover:bg-indigo-600 transition-colors' 
-                           : 'text-gray-600 bg-gray-800/50 cursor-not-allowed'
-                       }`}
-                       aria-disabled={currentPage <= 1}
-                     >
-                       <ChevronLeft className="w-5 h-5" />
-                     </Link>
-                     
-                     {/* Page numbers */}
-                     {paginationRange.map((page, index) => 
-                       page === -1 ? (
-                         // Ellipsis
-                         <span key={`ellipsis-${index}`} className="w-10 h-10 flex items-center justify-center text-gray-400">
-                           ...
-                         </span>
-                       ) : (
-                         // Page number
-                         <Link
-                           key={page}
-                           href={getPaginationUrl(page)}
-                           className={`flex items-center justify-center w-10 h-10 rounded-full transition-colors ${
-                             currentPage === page
-                               ? 'bg-indigo-600 text-white' 
-                               : 'text-gray-300 bg-gray-800 hover:bg-gray-700'
-                           }`}
-                         >
-                           {page}
-                         </Link>
-                       )
-                     )}
-                     
-                     {/* Next page button */}
-                     <Link 
-                       href={currentPage < totalPages ? getPaginationUrl(currentPage + 1) : '#'}
-                       className={`flex items-center justify-center w-10 h-10 rounded-full ${
-                         currentPage < totalPages 
-                           ? 'text-white bg-gray-800 hover:bg-indigo-600 transition-colors' 
-                           : 'text-gray-600 bg-gray-800/50 cursor-not-allowed'
-                       }`}
-                       aria-disabled={currentPage >= totalPages}
-                     >
-                       <ChevronRight className="w-5 h-5" />
-                     </Link>
-                   </nav>
-                 </div>
-               )}
- 
-               {/* Results summary */}
-               <div className="mt-6 text-center text-sm text-gray-500">
-                 Showing {(currentPage - 1) * ITEMS_PER_PAGE + 1} to {Math.min(currentPage * ITEMS_PER_PAGE, totalItems)} of {totalItems} images
-               </div>
-             </>
-           ) : (
-             <div className="flex flex-col items-center justify-center py-20">
-               <div className="flex items-center justify-center w-20 h-20 mb-6 rounded-full bg-indigo-900/20">
-                 <ImageIcon className="w-10 h-10 text-indigo-400" />
-               </div>
-               <h3 className="text-2xl font-medium text-white mb-3">No images found</h3>
-               <p className="text-gray-400 mb-8 max-w-md text-center">
-                 {searchQuery 
-                   ? `No results matching "${searchQuery}"` 
-                   : "No images matching the selected filters"}
-               </p>
-               <Link 
-                 href={getClearFilterUrl()}
-                 className="px-6 py-3 bg-indigo-600 text-white rounded-full font-medium hover:bg-indigo-700 transition-all shadow-lg hover:shadow-indigo-500/20"
-               >
-                 Clear filters
-               </Link>
+           {/* Pagination */}
+           {paginationRange.length > 0 && (
+             <div className="flex justify-center mt-8 mb-6">
+               <nav className="flex items-center space-x-1">
+                 {/* Previous page */}
+                 <Link
+                   href={currentPage > 1 ? getPaginationUrl(currentPage - 1) : '#'}
+                   className={`p-2 rounded-md ${
+                     currentPage > 1
+                       ? 'text-gray-300 hover:bg-gray-800 hover:text-white'
+                       : 'text-gray-600 cursor-not-allowed'
+                   }`}
+                   aria-disabled={currentPage <= 1}
+                   tabIndex={currentPage <= 1 ? -1 : undefined}
+                 >
+                   <ChevronLeft className="h-5 w-5" />
+                   <span className="sr-only">Previous Page</span>
+                 </Link>
+                 
+                 {/* Page numbers */}
+                 {paginationRange.map((page, i) => 
+                   page === -1 ? (
+                     // Ellipsis
+                     <span key={`ellipsis-${i}`} className="px-3 py-2 text-gray-500">
+                       ...
+                     </span>
+                   ) : (
+                     // Page number
+                     <Link
+                       key={page}
+                       href={getPaginationUrl(page)}
+                       className={`px-3 py-2 rounded-md ${
+                         currentPage === page
+                           ? 'bg-indigo-600 text-white'
+                           : 'text-gray-300 hover:bg-gray-800 hover:text-white'
+                       }`}
+                       aria-current={currentPage === page ? 'page' : undefined}
+                     >
+                       {page}
+                     </Link>
+                   )
+                 )}
+                 
+                 {/* Next page */}
+                 <Link
+                   href={currentPage < totalPages ? getPaginationUrl(currentPage + 1) : '#'}
+                   className={`p-2 rounded-md ${
+                     currentPage < totalPages
+                       ? 'text-gray-300 hover:bg-gray-800 hover:text-white'
+                       : 'text-gray-600 cursor-not-allowed'
+                   }`}
+                   aria-disabled={currentPage >= totalPages}
+                   tabIndex={currentPage >= totalPages ? -1 : undefined}
+                 >
+                   <ChevronRight className="h-5 w-5" />
+                   <span className="sr-only">Next Page</span>
+                 </Link>
+               </nav>
              </div>
            )}
```

---

Perfect! We've successfully implemented all the necessary components for an image popup that appears when clicking on images in the gallery while preserving the full page view when right-clicking and opening in a new tab.

Here's a summary of what we've done:

1. Created a new `ImageDetailsDialog` component that displays the image details in a popup dialog
2. Created a `GalleryImageCard` component that shows a thumbnail and opens the dialog when clicked
3. Created a `GalleryGrid` component that renders all the gallery images using our new card component
4. Updated the gallery page to use our new grid component
5. Created an API route for fetching image data including related and similar images
6. Modified the existing page component to export reusable server functions

The implementation follows your requirements:
- Users can click images to see a popup with details
- Right-clicking and opening in a new tab still shows the full page view
- The components match your current theme
- All functionality from the original detail page is preserved

The popup is responsive and provides the same rich information as the full page, just in a more convenient format for browsing the gallery.

---

